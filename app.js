function routerConfig(t,e,n){e.html5Mode({enabled:!0,requireBase:!1}),t.state("main",{url:"/",templateUrl:"views/main.html",controller:"mainCtrl"}),n.otherwise("/")}function toastConfig(t){angular.extend(t,{autoDismiss:!1,containerId:"toast-container",maxOpened:2,newestOnTop:!0,positionClass:"toast-top-right",preventDuplicates:!1,preventOpenDuplicates:!0,target:"body"})}function todoItems(){return{templateUrl:"views/todoItems/todoItems.html",scope:{},replace:!0,controller:todoItemsCtrl}}function todoItemsCtrl(t,e,n){t.items=e.list(),t.activeItemId="",t.item={},t.addItem=function(o){return o.name?(t.items=e.create(o),void(t.item.name="")):(n.error("Please, type a name"),!1)},t.showItem=function(e,n){t.activeItemId=e.id,t.$parent.$broadcast("showComments",{id:e.id,index:n})},t["delete"]=function(n){t.items=e["delete"](n),n===t.activeItemId&&t.$parent.$broadcast("postRemoved")},t.$on("increaseCommentCount",function(e,n){t.items=t.items.map(function(t){return t.id===n?{commentCount:t.commentCount+1,id:t.id,name:t.name}:t})})}function commentList(){return{templateUrl:"views/commentList/commentList.html",scope:{},replace:!0,controller:commentListCtrl}}function commentListCtrl(t,e,n){t.comments=[],t.comment={},t.addComment=function(o){return o.text?(o.color=o.color||"#e6e6e6",o.postId=t.postId,t.comments=e.create(o),t.comment={},void t.$parent.$broadcast("increaseCommentCount",t.postId)):(n.error("Please, type a text"),!1)},t.deleteComment=function(n){t.comments=e["delete"](n),t.$parent.$broadcast("decreaseCommentCount",t.postId)},t.$on("showComments",function(n,o){t.postId=o.id,t.index=o.index,t.comments=e.list(o.id)}),t.$on("postRemoved",function(){t.postId=null})}function storage(t){this.list=function(e){return JSON.parse(t.localStorage.getItem(e))||[]},this.create=function(e,n){var o=new Date,i=JSON.parse(t.localStorage.getItem(e))||[];return n.id=o.getTime(),i.push(n),t.localStorage.setItem(e,JSON.stringify(i)),this.list(e)},this.get=function(e,n){var o=JSON.parse(t.localStorage.getItem(e))||[];return o.filter(function(t){return t.id===n})},this.update=function(e,n,o){var i=JSON.parse(t.localStorage.getItem(e))||[];return i.map(function(t,e){t.id===n&&(i[e]=o)}),t.localStorage.setItem(e,JSON.stringify(i)),this.list(e)},this["delete"]=function(e,n){var o=JSON.parse(t.localStorage.getItem(e))||[];return o.map(function(t,e){t.id===n&&o.splice(e,1)}),t.localStorage.setItem(e,JSON.stringify(o)),this.list(e)}}function item(t){this.list=function(){return t.list("items")},this.create=function(e){return e.commentCount=0,t.create("items",e)},this.get=function(e){return t.get("items",e)[0]},this.update=function(e,n){return t.update("items",e,n)},this.removeComments=function(e){var n=t.list("comments");n.map(function(n){n.postId===e&&t["delete"]("comments",n.id)})},this["delete"]=function(e){return this.removeComments(e),t["delete"]("items",e)}}function comment(t,e){this.list=function(e){var n=t.list("comments");return n.filter(function(t){return t.postId===e})},this.create=function(n){var o=e.get(n.postId);return o.commentCount+=1,e.update(n.postId,o),t.create("comments",n),this.list(n.postId)},this.get=function(e){return t.get("comments",e)},this["delete"]=function(){return t["delete"]("comments",id)}}function mainCtrl(){}angular.module("spa",["router","config.toast","storage","service.item","service.comment","directives.todoItems","directives.commentList","ctrlSubmit"]),angular.module("router",["ui.router"]).config(routerConfig),routerConfig.$inject=["$stateProvider","$locationProvider","$urlRouterProvider"],angular.module("config.toast",["ngAnimate","toastr"]).config(toastConfig),toastConfig.$inject=["toastrConfig"],angular.module("directives.todoItems",[]).directive("todoItems",todoItems),todoItemsCtrl.$inject=["$scope","Item","toastr"],angular.module("directives.commentList",[]).directive("commentList",commentList),commentListCtrl.$inject=["$scope","Comment","toastr"],angular.module("ctrlSubmit",[]).directive("ctrlSubmit",function(){return{restrict:"A",link:function(t,e,n){e.bind("keydown",function(e){var o=e.keyCode||e.which;13===o&&e.ctrlKey&&(e.preventDefault(),t.$apply(n.ctrlSubmit))})}}}),angular.module("storage",[]).service("$storage",storage),storage.$inject=["$window"],angular.module("service.item",[]).service("Item",item),item.$inject=["$storage"],angular.module("service.comment",[]).service("Comment",comment),comment.$inject=["$storage","Item"],angular.module("spa").controller("mainCtrl",mainCtrl),mainCtrl.$inject=[];